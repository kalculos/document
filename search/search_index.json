{"config":{"lang":["en","zh"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Kalculos \u6587\u6863","text":"<p>\u6b64\u5904\u4e3a Kalculos \u76f8\u5173\u9879\u76ee\u7684\u516c\u5171\u6587\u6863\u9875\u9762\uff0c\u4f60\u53ef\u4ee5\u5728\u5de6\u4fa7\u7684\u4fa7\u8fb9\u680f\u4e0a\u67e5\u9605\u76f8\u5173\u4fe1\u606f\u3002</p>"},{"location":"kiwi/devutils/","title":"\u53cd\u5c04\u5de5\u5177","text":"<p>Warning</p> <p>Kiwi \u63d0\u4f9b\u7684\u82e5\u5e72\u53cd\u5c04\u5de5\u5177\u4e2d\u6709\u4e00\u90e8\u5206\u7c7b\u88ab\u6807\u6ce8\u4e86 <code>@ApiStatus.Experimental</code>. \u8fd9\u662f\u56e0\u4e3a\u4ed6\u4eec\u76f4\u63a5 \u6216\u95f4\u63a5\u7684\u4f9d\u8d56\u4e8e <code>sun.misc.Unsafe</code> \u4ee5\u53ca MethodHandles \u4e2d\u7684\u7279\u6743 Lookup. \u8fd9\u4e24\u8005\u5747\u6709\u53ef\u80fd\u5728\u672a\u6765\u7684\u67d0\u4e2a JDK \u7248\u672c\u4e0a\u88ab\u7981\u6b62\u4f7f\u7528\uff0c\u56e0\u6b64\u4f60\u5e94\u8be5\u907f\u514d\u5c06\u4e1a\u52a1\u4ee3\u7801\u4f9d\u8d56\u5728\u8fd9\u4e9b\u4e0d\u7a33\u5b9a\u7684 API \u4e0a\u3002</p>"},{"location":"kiwi/devutils/#unsafe-diag","title":"Unsafe &amp; Diag","text":"<p><code>io.ib67.kiwi.reflection.Unsafe</code> \u63d0\u4f9b\u4e86\u5bf9 <code>jdk.internal.Unsafe</code> / <code>sun.misc.Unsafe</code> \u4ee5\u53ca Trusted Lookup \u7684\u8bbf\u95ee\u3002\u8fd9\u4e9b\u7c7b \u5c5e\u4e8e OpenJDK \u7684\u5b9e\u73b0\u7ec6\u8282\uff0c\u5e76\u6709\u53ef\u80fd\u5728\u672a\u6765\u88ab\u79fb\u9664\uff0c\u6216\u662f\u5176\u64cd\u4f5c\u6743\u9650\u8303\u56f4\uff0c\u8bed\u4e49\u6709\u53ef\u80fd\u88ab\u6539\u53d8\u3002\u56e0\u6b64\u8bf7\u4ec5\u5f53\u4f60\u77e5\u9053\u4e14\u5fc5\u8981\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528\u8fd9\u4e9b\u5de5\u5177\u3002</p> <p><code>Diag</code> \u662f\u4e00\u4e9b\u7528\u4e8e\u5e2e\u52a9\u5f00\u53d1\u8005\u8bca\u65ad\u95ee\u9898\u7684\u5de5\u5177\u3002\u76ee\u524d\u53ea\u6709 <code>dumpObjectTree(int indent, Object obj)</code> \u53ef\u7528\u3002\u5176\u8fd4\u56de\u4e00\u4e2a <code>Uni&lt;String&gt;</code>, \u8be5 Uni \u4e2d\u7684 \u6bcf\u4e2a String \u5bf9\u5e94\u4e00\u884c\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u6253\u5370\u5230 <code>PrintStream</code> (System.out) \u6216\u662f\u50a8\u5b58\u8d77\u6765\u8f6c\u50a8\u4f7f\u7528\u3002</p> <p>\u8f93\u51fa\u793a\u4f8b\uff1a <code>Diag.dumpObjectTree(2, List.of(1,2,3,4)).onItem(System.out::println);</code></p> <pre><code>j.u.ImmutableCollections$ListN #2d72f75e {\n  elements (super) = 4 [\n    0. 1\n    1. 2\n    2. 3\n    3. 4\n  ]\n  allowNulls (super) = false\n}\n</code></pre> <p>\u6587\u6cd5\uff1a   - \u5bf9\u8c61: <code>fqdn.Class[#Sub[#Sub..] #hashCode { kvPair[] }</code>   - kvPair: <code>[(inaccessible)] fieldName [(super)] = value</code>   - value:     - Primitive and String: Their value. <code>1</code> <code>\"hello\"</code> <code>true</code>     - Primitive Array: <code>num [ elements[] ]</code>     - Array: <code>len [ (index. element\\n)[] ]</code>     - Visited Object (recursive reference): <code>(visited) #hashCode</code>     - null: <code>null</code> </p> <p>\u8bf4\u4eba\u8bdd\uff1a   - <code>(inaccessible) data</code> \u5c31\u662f\u65e0\u6cd5\u8bbf\u95ee\u5230\u8fd9\u4e2a\u5b57\u6bb5\u7684\u503c\uff08\u901a\u5e38\u4e0d\u53ef\u80fd\u51fa\u73b0\uff09   - <code>element (super)</code> \u5c31\u662f\u8fd9\u4e2a\u5b57\u6bb5\u662f\u4f60\u7ed9\u7684\u5bf9\u8c61\u7684\u7236\u7c7b\u91cc\u9762\u6765\u7684   - \u6570\u7ec4\u5f00\u5934\u7684\u6570\u5b57\u662f\u5143\u7d20\u4e2a\u6570\uff0c\u5bf9\u4e8e\u975e\u539f\u8bed\u7684\u6570\u7ec4\u81f3\u5c11\u4e00\u884c\u4e00\u4e2a\u5143\u7d20\uff0c\u6bcf\u4e2a\u5143\u7d20\u5f00\u5934\u7684\u6570\u5b57\u662f\u5b83\u7684\u4e0b\u6807   - \u5bf9\u4e8e\u5728\u6253\u5370\u4e4b\u524d\u5df2\u7ecf\u8bbf\u95ee\u8fc7\u7684\u6570\u636e\uff0c\u4f1a\u88ab\u6807\u8bb0 <code>(visited)</code> \u8868\u793a\u5df2\u7ecf\u8bbf\u95ee\u8fc7\u4e86\uff0c\u907f\u514d\u9012\u5f52   - \u5bf9\u8c61\u7684\u7c7b\u540d\u4f1a\u88ab\u7f29\u5199\u6210\u6bcf\u6bb5\u5305\u540d\u53ea\u4fdd\u7559\u7b2c\u4e00\u4e2a\u5b57\u6bcd\u7684\u6837\u5b50\uff0c\u6bd4\u5982 <code>j.l.String</code> </p> <p>\u901a\u5e38\u4f60\u53ea\u5e94\u8be5\u5728\u8c03\u8bd5\u4ee3\u7801\u91cc\u4f7f\u7528 <code>Diag</code> \u5de5\u5177\u3002</p>"},{"location":"kiwi/devutils/#reflections","title":"Reflections","text":"<p><code>Reflections</code> \u5305\u542b\u4e86\u4e00\u4e9b\u8f85\u52a9\u53cd\u5c04\u7684\u5de5\u5177\uff0c\u5e76\u4e14\u8fd9\u4e9b\u5de5\u5177\u6ca1\u6709\u6d89\u53ca\u5230 <code>Unsafe</code> \u5185\u5bb9\uff0c\u53ef\u4ee5\u653e\u5fc3\u4f7f\u7528\u3002\u5177\u4f53\u6709\u54ea\u4e9b\u5de5\u5177\u8bf7\u79fb\u6b65 Javadocs</p>"},{"location":"kiwi/","title":"What's Kiwi","text":"<p>Expressive Java utilites and robost libraries tuned for performance.</p> <p>Documentation &amp; API work in progress.</p>"},{"location":"kiwi/#_1","title":"\u4e0a\u624b\u4f7f\u7528","text":"<p>\u5f53\u524d\u7248\u672c\u4e3a\uff1a</p> <p>\u6dfb\u52a0\u5230\u4f60\u7684 <code>build.gradle</code>:</p> <pre><code>def kiwiVersion = \"1.1.0\" // kiwi \u7684\u7248\u672c\u53f7\uff0c\u6b64\u5904\u53ef\u80fd\u5e76\u4e0d\u662f\u6700\u65b0\u7248\u672c\nrepositories {\n    maven {\n        name = \"Kalculos\"\n        url = \"https://repo.sfclub.cc/releases\"\n    }\n}\ndependencies {\n    api \"io.ib67.kiwi:lang:$kiwiVersion\"\n}\n</code></pre> <p>\u4ece 1.0.0 \u5f00\u59cb\uff0cKiwi \u4f7f\u7528 Java 21 \u7f16\u8bd1\u3002\u5bf9\u4e8e 0.xx \u7248\u672c\u7684 Kiwi \u6587\u6863\uff0c\u53ef\u4ee5\u5728 \u8fd9\u91cc \u627e\u5230\u3002</p> <p>Javadoc \u5730\u5740: https://repo.sfclub.cc/javadoc/releases/io/ib67/kiwi/javadoc/latest \u5bf9\u4e8e SNAPSHOT \u7248\u672c: https://repo.sfclub.cc/javadoc/snapshots/io/ib67/kiwi/javadoc/latest</p>"},{"location":"kiwi/options/","title":"Kiwi \u53c2\u6570","text":"\u53c2\u6570 \u63cf\u8ff0 \u9ed8\u8ba4\u503c \u5907\u6ce8 <code>kiwi.event.asmdumpdir</code> kiwi \u4e8b\u4ef6\u7cfb\u7edf\u4e2d <code>AsmListenerResolver</code> \u751f\u6210\u7c7b\u540e\u5bfc\u51fa\u7684\u4f4d\u7f6e null \u8c28\u4f9b\u8c03\u8bd5\u4f7f\u7528"},{"location":"kiwi/options/#_1","title":"\u6784\u5efa\u53c2\u6570","text":"\u53c2\u6570 \u63cf\u8ff0 \u5907\u6ce8 -Dperfasm \u8fd0\u884c kiwi:event:jmh \u65f6\u4f7f\u7528 perfasm \u5256\u6790\u5668 -Dfastdebug \u8fd0\u884c kiwi:event:jmh \u65f6\u4f7f\u7528 fastdebug \u7248\u672c\u7684 jdk \u5e76\u4e14\u8f93\u51fa jitlog JDK \u4f4d\u7f6e\u4ece\u73af\u5883\u53d8\u91cf <code>FASTDEBUG_JDK_HOME</code> \u4e2d\u8bfb\u53d6"},{"location":"kiwi/typetoken/","title":"TypeToken","text":"<p>Java \u6709\u6cdb\u578b\uff0c\u5373\u7c7b\u578b\u53c2\u6570\u3002\u4f46\u662f Javac \u5728\u7f16\u8bd1\u7684\u65f6\u4f1a\u5c06\u7c7b\u578b\u53c2\u6570\u5c3d\u6570\u64e6\u9664\uff0c\u4f7f\u5f97 <code>List&lt;String&gt;</code> \u4e0e <code>List</code> \u7b49\u4ef7\uff0c\u8fd9\u5c31\u53eb\u505a\u6cdb\u578b\u64e6\u9664\u3002\u800c <code>TypeToken&lt;C&gt;</code> \u5c31\u662f\u4e3a\u4e86 \u5728\u8fd9\u4e2a\u5927\u524d\u63d0\u4e0b\u5728\u8fd0\u884c\u65f6\u8868\u8fbe\u6cdb\u578b\u800c\u4ea7\u751f\u7684\u3002</p>"},{"location":"kiwi/typetoken/#_1","title":"\u57fa\u672c\u7528\u6cd5","text":"<p>\u6355\u83b7\u7c7b\u578b\uff1a <pre><code>var tk = new TypeToken&lt;List&lt;String&gt;&gt;(){};\ntk.getBaseTypeRaw(); // List.class\ntk.getTypeParams().getFirst(); // String.class\ntk.toString(); // List&lt;String&gt;\n</code></pre></p> <p>\u9664\u4e86 subclassing\uff0c\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u586b\u5145\u53c2\u6570\u624b\u52a8\u6784\u9020\u4efb\u610f <code>TypeToken&lt;C&gt;</code>: <pre><code>var tk = TypeToken.getParameterized(List.class, String.class); // equals to new TypeToken&lt;List&lt;String&gt;&gt;(){};\n// Resolve a token by class (or parameterizedType)\nvar stringTk = TypeToken.resolve(String.class);\nvar listObjTk = TypeToken.resolve(List.class); // List&lt;Object&gt;, Parameters will be filled by TypeVars' upper/lower bound.\n</code></pre></p> <p>\u4e5f\u652f\u6301 Wildcard: <pre><code>var tk = new TypeToken&lt;List&lt;? extends CharSequence&gt;&gt;(){};\ntk.toString(); // List&lt;? extends CharSequence&gt;\ntk.getTypeParams().getFirst().isWildcard(); // true\n</code></pre></p> <p>\u4f60\u53ef\u4ee5\u901a\u8fc7 <code>reduceBounds</code> \u5c06 <code>TypeToken&lt;C&gt;</code> \u6811\u5185\u7684\u6240\u6709 Wildcard \u90fd\u5f52\u5e76\u5230\u5b83\u4eec\u7684\u4e0a\u4e0b\u754c\u4e0a\u3002</p> <pre><code>TypeToken.reduceBounds(tk, /* liftBySuper */ true); // TypeToken&lt;List&lt;CharSequence&gt;&gt;\n</code></pre>"},{"location":"kiwi/typetoken/#_2","title":"\u7c7b\u578b\u63a8\u5bfc","text":"<p>TypeToken \u8fd8\u652f\u6301\u901a\u8fc7\u5df2\u6709\u7684\u4fe1\u606f\u63a8\u5bfc\u51fa\u5177\u4f53\u7684\u7c7b\u578b\u3002</p> <pre><code>interface Cube&lt;T&gt; {\n\n}\n\nclass Box&lt;A&gt; implements Cube&lt;A&gt; {\n    A type;\n}\n\nvar boxTk = TypeToken.getParameterized(Box.class, String.class);\nboxTk.resolveField(Box.class.getDeclaredField(\"type\")); // String.class\nboxTk.inferType(Cube.class); // TypeToken&lt;Cube&lt;String&gt;&gt;\n</code></pre> <p>\u76ee\u524d resolveType \u5c1a\u4e0d\u652f\u6301 wildcard\u3002 \u6b64\u5916\uff0c<code>TypeToken&lt;C&gt;</code> \u5185\u8fd8\u6709\u5f88\u591a\u5de5\u5177\u65b9\u6cd5\uff0c\u5982\u5bfb\u627e\u5230\u67d0\u4e2a\u8d85\u7c7b\u7684\u8def\u5f84\u7b49\uff0c\u8be6\u60c5\u8bf7\u67e5\u9605 Javadoc.</p>"},{"location":"kiwi/uni/","title":"Uni &amp; Result","text":"<p><code>Uni&lt;T&gt;</code> \u662f\u4e00\u4e2a <code>Consumer&lt;Consumer&lt;T&gt;&gt;</code>\u3002\u7b80\u5355\u7684\u8bf4\uff0c\u4f60\u4f20\u7ed9\u4ed6\u4e00\u4e2a <code>Consumer&lt;T&gt;</code> \u7684\u95ed\u5305\uff08so-called \"Lambda\")\uff0c\u4e4b\u540e\u5b83\u4f1a\u5f00\u59cb\u4ea7\u751f\u65b0\u5143\u7d20\uff0c\u5e76\u4e14\u4f20\u9012\u5230\u4f60\u7684\u95ed\u5305\u91cc\u9762\u3002  \u6bcf\u4f20\u4e00\u6b21\u95ed\u5305\uff08\u8c03\u7528 <code>onItem</code> \u65b9\u6cd5\uff09\uff0c<code>Uni&lt;T&gt;</code> \u90fd\u4f1a\u91cd\u65b0\u8ba1\u7b97\u5e76\u4e14\uff08\u5728\u65e0\u526f\u4f5c\u7528\u7684\u60c5\u51b5\u4e0b\uff09\u4f7f\u7528\u76f8\u540c\u7684\u5143\u7d20\u5e8f\u5217\u8c03\u7528\u4f60\u7684\u95ed\u5305\uff0c\u7c7b\u4f3c\u4e00\u4e2a <code>Supplier&lt;Stream&lt;T&gt;&gt;</code>\u3002</p> <p>\u6d88\u8d39\u4e00\u4e2a <code>Uni&lt;Integer&gt;</code>: <pre><code>void main(){\n    Uni&lt;Integer&gt; uni = Uni.infiniteAscendingNumber().limit(6);\n    // \u6253\u5370 1, 2, 3, 4, 5, ..............\n    uni.onItem(System.out::println);\n    // \u6253\u5370 0, 2, 4, ...\n    uni.filter(it -&gt; it % 2 == 0).onItem(System.out::println);\n}\n</code></pre></p> <p>\u63d0\u4f9b\u4e00\u4e2a <code>Uni&lt;Integer&gt;</code>: <pre><code>Uni&lt;Integer&gt; infiniteAscendingNumber(){\n    return consumer -&gt; {\n        int i = 0;\n        while(true) consumer.accept(i++); // \u53ef\u4ee5\u7c7b\u6bd4\u4e3a\uff1a yield i++\n    };\n}\n</code></pre></p> <p>\u5982\u679c\u4f60\u66fe\u7ecf\u4f7f\u7528\u8fc7\u5176\u4ed6\u8bed\u8a00\u4e2d\u751f\u6210\u5668\u7279\u6027\u7684 <code>yield</code> \u529f\u80fd\uff0c\u4f60\u53ef\u4ee5\u8ba4\u4e3a <code>Uni&lt;T&gt;</code> \u5b9e\u9645\u4e0a\u5c31\u662f\u522b\u7684\u8bed\u8a00\u4e2d\u5e38\u89c1\u7684\u751f\u6210\u5668\u3002  </p> <p>\u4f7f\u7528 <code>Uni&lt;T&gt;</code> \u7684\u751f\u6210\u5668\u7279\u6027\uff0c\u4f60\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5904\u7406\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\uff1a <pre><code>    public static Uni&lt;Method&gt; iterateMethodsWithSuper(Class&lt;?&gt; clazz) {\n        if (clazz == null) return Fail.none();\n        return c -&gt; {\n            for (Method declaredMethod : clazz.getDeclaredMethods()) {\n                c.onValue(declaredMethod);\n            }\n            for (Class&lt;?&gt; anInterface : clazz.getInterfaces()) {\n                iterateMethodsWithSuper(anInterface).onItem(c);\n            }\n            iterateMethodsWithSuper(clazz.getSuperclass()).onItem(c);\n        };\n    }\n    iterateMethodsWithSuper(...).onItem(...); // \u9012\u5f52\u904d\u5386\u4e00\u9897\u7c7b\u578b\u6811\u4e0a\u7684\u6240\u6709\u65b9\u6cd5\n</code></pre></p> <p>\u5982\u679c\u4f60\u5bf9 <code>Uni&lt;T&gt;</code> \u7684\u539f\u7406\u611f\u5174\u8da3\uff0c\u53ef\u4ee5\u79fb\u6b65\u8fd9\u4e00\u7bc7\u6587\u7ae0\u3002 Kiwi \u4e2d\u7684 <code>Uni&lt;T&gt;</code> \u5c31\u662f\u6587\u4e2d <code>Seq&lt;T&gt;</code> \u5728\u5de5\u7a0b\u4e0a\u7684\u8fdb\u4e00\u6b65\u6269\u5c55\u3002</p>"},{"location":"kiwi/uni/#interruption","title":"Interruption","text":"<p>\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u4f60\u4f1a\u53d1\u73b0 <code>infiniteAscendingNumber</code> \u91cc\u662f\u4e00\u4e2a\u6b7b\u5faa\u73af\uff0c\u800c <code>limit()</code> \u5374\u53ef\u4ee5\u9650\u5236\u5143\u7d20\u7684\u4e2a\u6570\uff0c\u8fd9\u662f\u901a\u8fc7\u53d7\u68c0\u5f02\u5e38\u7c7b\u578b <code>Interruption</code> \u5b9e\u73b0\u7684\u3002  </p> <p><code>Interruption</code> \u5e76\u4e0d\u6346\u7ed1 <code>Uni</code>\uff0c\u4f60\u53ef\u4ee5\u5728\u7a0b\u5e8f\u91cc\u5176\u4ed6\u9700\u8981\u4f7f\u7528\u4e2d\u65ad\u7684\u5730\u65b9\u4e5f\u91c7\u7528\u5b83\u5b9e\u73b0\u63a7\u5236\u6d41\u7ec8\u6b62\u3002\u5b83\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\u5355\u4f8b\uff1a <code>Interruption.INTERRUPTION</code>\u3002\u629b\u51fa Interruption \u7684\u6027\u80fd\u635f\u8017\u76f8\u6bd4\u4e00\u822c\u7684\u5f02\u5e38\u8981\u5c0f\uff0c\u8fd9\u662f\u56e0\u4e3a <code>Interruption</code> \u5e76\u4e0d\u4f1a\u82b1\u65f6\u95f4\u586b\u5145\u6808\u5e27\uff0c\u5e76\u4e14\u4e5f\u4e0d\u4f1a\u88ab\u521b\u5efa\u591a\u4e2a\u5b9e\u4f8b\u3002</p> <p><code>Uni&lt;T&gt;</code> \u4e2d\u8fd8\u63d0\u4f9b\u4e86\u4e13\u95e8\u9488\u5bf9 <code>Interruption</code> \u7684\u82e5\u5e72 <code>Consumer&lt;T&gt;</code> \u53d8\u79cd\uff0c\u8be6\u60c5\u8bf7\u79fb\u6b65\u6e90\u4ee3\u7801\u3002</p>"},{"location":"kiwi/uni/#uniop","title":"UniOp","text":"<p>\u867d\u7136 <code>Uni&lt;T&gt;</code> \u4e2d\u5df2\u7ecf\u5b9a\u4e49\u4e86\u82e5\u5e72\u7ba1\u9053\u65b9\u6cd5\uff0c\u4f46\u662f\u4ecd\u7136\u6709\u672a\u80fd\u8986\u76d6\u5230\u7684\u4f7f\u7528\u60c5\u666f\u3002\u597d\u5728\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>Uni#then(UnaryOperator&lt;T&gt;)</code> \u5b9a\u4e49\u65b0\u7684\u7ba1\u9053\u64cd\u4f5c\u3002</p> <p>\u4f8b\u5b50\uff1a\u5bf9\u4e8e <code>Uni&lt;T&gt;</code> \u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\uff0c\u5206\u6d3e\u5230 <code>Executor</code> \u518d\u8fd0\u884c\u63a5\u4e0b\u6765\u7684\u7ba1\u9053</p> <pre><code>import java.util.concurrent.ForkJoinPool;\n\nvoid parallelUni() {\n    users().then(UniOp.executor(ForkJoinPool.commonPool())).onItem(User::notifyPasswordEmail);\n    // Equals to\n    userStream().parallelStream().forEach(User::notifyPasswordEmail);\n\n    users().then(\n            UniOp.dispatch(\n                    User::isVip, User::sendGift,\n                    User::isBanned, it -&gt; {} // empty operation\n            )\n    ).onItem(User::doSomethingForNormalUser);\n}\n</code></pre> <p>\u4f7f\u7528 <code>#then</code> \u65b9\u6cd5\u4f60\u53ef\u4ee5\u6269\u5c55\u51fa\u8bb8\u591a\u65b0\u7684\u64cd\u4f5c\u3002\u5728 <code>UniOp</code> \u7c7b\u4e2d\u6709\u4e00\u4e9b\u6bd4\u8f83\u5c11\u7528\u7684\u7ba1\u9053\u64cd\u4f5c\uff08\u5982 dispatch \u548c executor\uff09\uff0c\u8bf7\u81ea\u884c\u67e5\u9605\u6e90\u4ee3\u7801\u3002</p>"},{"location":"kiwi/uni/#result","title":"Result","text":"<p><code>Result&lt;T&gt;</code> \u662f <code>Uni&lt;T&gt;</code> \u7684\u5b50\u7c7b\u578b\u3002\u5b83\u6709\u4e14\u4ec5\u80fd\u6709 <code>Some&lt;T&gt;</code> \u548c <code>Fail&lt;?&gt;</code> \u4e24\u79cd\u7c7b\u578b (sealed)</p> <p>Example: <pre><code>Result&lt;UserInfo&gt; result = Result.fromNotNull(() -&gt; userDao.queryById(usrId));\nreturn switch(result){\n    // \u4f7f\u7528\u6a21\u5f0f\u5339\u914d\u548c when clause \u5b9e\u73b0\u9519\u8bef\u5904\u7406\n    case Some(UserInfo user) when user.isAdmin -&gt; \"Welcome back, Administrator \"+user;\n    case Some(UserInfo user) -&gt; \"Welcome back! \" + user;\n    case Fail(Exception e) -&gt; \"An error occurred when gathering user info: \"+e;\n    // result == Fail.none()\n    case Fail(Fail.Nothing n) -&gt; \"User not found!\" \n}\n</code></pre></p> <p>\u6216\u8005\u50cf <code>Optional&lt;T&gt;</code> \u4e00\u6837\u4f7f\u7528\uff1a <pre><code>Result&lt;UserInfo&gt; result = gatherUserInfo(usrId);\nreturn result.orElseThrow(); // or #toOptional() -&gt; Optional&lt;T&gt;\n</code></pre></p> <p>\u53c8\u56e0\u4e3a <code>Result&lt;T&gt;</code> \u672c\u8eab\u4e5f\u662f\u4e00\u4e2a <code>Uni&lt;T&gt;</code>, \u56e0\u6b64 <code>Uni&lt;T&gt;</code> \u4e2d\u7684\u7ba1\u9053\u64cd\u4f5c\u540c\u6837\u9002\u7528\uff1a (\u4f46\u662f\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4f7f\u7528\u9664 <code>filter</code>, <code>map</code> \u7684\u7ba1\u9053\u540e\u5c06\u4f1a\u8f6c\u5316\u4e3a <code>Uni</code>\uff0c\u5c4a\u65f6\u5c06\u65e0\u6cd5\u4f7f\u7528 Result \u4e2d\u7684\u65b9\u6cd5) <pre><code>void test(){\n    gatherUserInfo(usrId)\n            .filter(UserInfo::isAdmin)\n            .onItem(...);\n    // \u6216\u8005\u4f60\u53ef\u4ee5\u76f4\u63a5\n    gatherUserInfo(usrId).onItem(...);\n}\n</code></pre></p> <p>\u5bf9\u4e8e <code>Fail&lt;?&gt;</code> \u7c7b\u578b\uff0c<code>onItem</code> \u6c38\u8fdc\u4e0d\u4f1a\u88ab\u8c03\u7528\uff0c\u4e14 <code>T get()</code> \u65b9\u6cd5\u603b\u662f\u8fd4\u56de null. \u901a\u5e38\u6765\u8bf4\uff0c\u4f60\u5e94\u8be5\u53ea\u8003\u8651\u4f7f\u7528\u6a21\u5f0f\u5339\u914d\uff08\u4e0a\u6587\u4e2d\u7b2c\u4e00\u79cd\u7528\u6cd5\uff09\u6216\u8005\u4f5c\u4e3a <code>Uni</code> \u4f7f\u7528\u7ba1\u9053\u64cd\u4f5c\u3002\u7531\u4e8e <code>onItem</code> \u4e0d\u4f1a\u88ab\u8c03\u7528\uff0c\u56e0\u6b64\u4f60\u53ef\u4ee5\u5728\u7ba1\u9053\u4e2d\u4e0d\u8003\u8651\u5931\u8d25/\u65e0\u503c\u7684\u60c5\u51b5\uff0c\u7ba1\u9053\u4ec5\u5728\u6210\u529f\u65f6\u88ab\u8c03\u7528\u3002</p>"},{"location":"kiwi/uni/#result_1","title":"\u4f7f\u7528 Result \u6355\u83b7\u53d7\u68c0\u5f02\u5e38","text":"<p><code>Result.fromAny(AnySupplier&lt;T&gt;)</code> \u53ef\u4ee5\u6355\u83b7 <code>AnySupplier&lt;T&gt;</code> \u4e2d\u7684\u53d7\u68c0\u5f02\u5e38\u4ece\u800c\u4f7f\u7528 <code>Result</code> \u5904\u7406\u7ed3\u679c.</p> <pre><code>Result.fromAny(() -&gt; Files.readString(...))\n        .onFail(...)\n        .onItem(...);\n</code></pre> <p>\u5982\u679c\u4f60\u5e0c\u671b\u89c6 null \u4e3a\u9519\u8bef\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>Result.fromNotNull</code>.  \u540c\u6837\uff0c\u4ed6\u8fd8\u6709\u4e00\u4e2a <code>runAny</code>\u3002\u66f4\u591a\u7ec6\u8282\u8bf7\u54a8\u8be2\u67e5\u9605\u6e90\u4ee3\u7801\u3002</p>"},{"location":"kiwi/events/","title":"What's Kiwi-Event","text":"<p><code>kiwi-event</code> \u662f\u4e00\u4e2a\u57fa\u4e8e Kiwi \u5b9e\u73b0\u7684\u7b80\u6613 EventBus. \u4e00\u4e2a EventBus \u8d1f\u8d23\u5c06\u4e8b\u4ef6\u4f20\u8fbe\u7ed9\u6240\u6709\u76d1\u542c\u8fd9\u4e2a\u4e8b\u4ef6\u7684 Handler.</p>"},{"location":"kiwi/events/#_1","title":"\u4e0a\u624b\u4f7f\u7528","text":"<p>\u5f53\u524d\u7248\u672c\u4e3a\uff1a</p> <p>\u6dfb\u52a0\u5230\u4f60\u7684 <code>build.gradle</code>:</p> <pre><code>dependencies {\n    api \"io.ib67.kiwi:event:$kiwiVersion\"\n}\n</code></pre> <p>\u5728\u914d\u7f6e\u597d\u4f9d\u8d56\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u59cb\u7f16\u5199\u4e8b\u4ef6\u76d1\u542c\u5668\u4e86\u3002</p>"},{"location":"kiwi/events/#_2","title":"\u6ce8\u518c\u4e0e\u76d1\u542c","text":"<p>\u5728\u4f7f\u7528 EventBus \u4e4b\u524d\uff0c\u9996\u5148\u9700\u8981\u7528\u4e8e\u4f20\u9012\u4fe1\u606f\u7684\u4e8b\u4ef6\u3002 <pre><code>public record NumberEvent(int i) implements Event { }\n</code></pre></p> <p>\u63a5\u7740\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a EventBus \u7528\u6765\u76d1\u542c/\u4f20\u9012\u4e8b\u4ef6\u3002 <pre><code>var bus = new HierarchyEventBus();\nbus.register(NumberEvent.class, this::handleNumber);\n\nvoid handleNumber(NumberEvent event){\n    // ... do your business\n}\n</code></pre></p> <p>\u4e4b\u540e\u4f60\u5c31\u53ef\u4ee5\u5f80\u91cc\u9762\u6295\u9012\u4e8b\u4ef6\u4e86\u3002 <pre><code>bus.post(new NumberEvent(1));\n</code></pre></p> <p><code>HierarchyEventBus</code> \u540c\u6837\u8fd8\u652f\u6301\u4f20\u9012\u5230\u7c7b\u5c42\u7ea7\u4e0a: <pre><code>bus.register(Event.class, this::handleAllEvent);\n\nvoid handleAllEvent(Event event){\n    // ... all events, including NumberEvent\n}\n</code></pre> <code>HierarchyEventBus</code> \u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002</p>"},{"location":"kiwi/events/#_3","title":"\u6cdb\u578b\u4e8b\u4ef6","text":"<p>\u5728 <code>HierarchyEventBus</code> \u4e2d\uff0c\u6240\u6709\u7684\u7c7b\u578b\u68c0\u7d22\u90fd\u662f\u901a\u8fc7 TypeToken \u8fdb\u884c\u7684\uff0c\u56e0\u6b64\u5b83\u5929\u7136\u7684\u652f\u6301\u533a\u5206\u5f00\u6cdb\u578b\u4e8b\u4ef6\u3002 \u8981\u5b9e\u73b0\u652f\u6301\u6cdb\u578b\u7684\u4e8b\u4ef6\uff0c\u53ea\u9700\u8981\u5728\u8be5\u4e8b\u4ef6\u7684 <code>type()</code> \u65b9\u6cd5\u4e2d\u6839\u636e\u60c5\u51b5\u7279\u6b8a\u5904\u7406\u5373\u53ef\u3002 <pre><code>record Box&lt;A&gt;(A a) implements Event{\n    @Override\n    public TypeToken&lt;?&gt; type(){\n        return TypeToken.getParameterized(Box.class, a.getClass());\n    }\n}\n</code></pre></p> <p>\u5728\u5b9e\u9645\u60c5\u666f\u4e2d\uff0c\u4f60\u53ef\u80fd\u4f1a\u5e0c\u671b\u5bf9 <code>type()</code> \u7684\u8fd4\u56de\u503c\u8fdb\u884c\u7f13\u5b58\u4ee5\u52a0\u5feb\u4e8b\u4ef6\u6d3e\u53d1\u7684\u901f\u5ea6\uff08\u5728\u4e0a\u6587\u4e2d\u7531\u4e8e\u7bc7\u5e45\u5173\u7cfb\u7701\u7565\u6389\u4e86\u8fd9\u4e9b\u4ee3\u7801\uff09\u3002 <code>HierarchyEventBus</code> \u5728\u7b2c\u4e00\u6b21\u9047\u89c1\u4e0d\u8ba4\u8bc6\u7684\u7c7b\u578b\u65f6\uff0c\u4f1a\u5bf9\u8be5\u7c7b\u578b -&gt; Event \u4e0a\u6574\u4e2a\u94fe\u8def\u7684\u6240\u6709\u7c7b\u578b\u5747\u6309\u7167\u6cdb\u578b\u8bed\u4e49\u8fdb\u884c\u4e00\u6b21\u521d\u59cb\u5316\u3002\u5982\u679c\u8be5\u4e8b\u4ef6\u7c7b\u578b\u540c\u65f6\u5177\u6709\u4e24\u6761\u901a\u5f80 Event \u7684\u7c7b\u578b\u8def\u5f84\uff0c\u5219\u9009\u53d6\u5b9a\u4e49\u987a\u5e8f\u91cc\u9760\u7684\u6700\u8fd1\u7684\u90a3\u4e2a\u3002</p>"},{"location":"kiwi/events/#_4","title":"\u4f7f\u7528\u6ce8\u89e3\u6ce8\u518c","text":"<p>kiwi-event \u540c\u6837\u652f\u6301\u4f7f\u7528\u6ce8\u89e3\u65b9\u6cd5\u6765\u6ce8\u518c\u4e8b\u4ef6\u76d1\u542c\u5668\u3002</p> <pre><code>class MyListener implements EventListenerHost {\n    @SubscribeEvent\n    void onNumber(NumberEvent number){\n        // ...\n    }\n\n    @SubscribeEvent\n    void onBox(BoxEvent&lt;Integer&gt; intBox){\n        // ...\n    }\n}\n\nnew MyListener().registerTo(bus);\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u51e0\u70b9\uff1a 1. \u7528\u4e8e\u5b58\u653e\u76d1\u542c\u5668\u7684\u7c7b\u9700\u8981\u5b9e\u73b0 <code>EventListenerHost</code> \u63a5\u53e3\u3002 2. \u76d1\u542c\u5668\u65b9\u6cd5\u5e94\u8be5\u4f7f\u7528 <code>default</code>, <code>public</code> \u6216 <code>protected</code> \u8bbf\u95ee\u4fee\u9970\u7b26\uff0c\u5426\u5219\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\u3002 3. \u5982\u679c\u4f7f\u7528 <code>registerTo</code> \u65b9\u6cd5\u6ce8\u518c\u5230 EventBus \u4e0a\uff0c\u8bf7\u786e\u4fdd\u4f60\u7684\u9879\u76ee Jigsaw \u6a21\u5757\uff08\u5982\u679c\u6709\uff09\u5bf9 Kiwi \u5f00\u653e\u3002  </p> <p><code>registerTo</code> \u65b9\u6cd5\u5c06\u4f1a\u59d4\u6258 <code>AsmListenerResolver</code> \u626b\u63cf\u5f53\u524d\u7c7b\u4e0a\u7684\u6240\u6709 <code>@SubscribeEvent</code> \u65b9\u6cd5\uff08\u4e0d\u652f\u6301\u7236\u7c7b\uff09\uff0c\u5e76\u4e14\u4e3a\u6bcf\u4e2a\u65b9\u6cd5\u5355\u72ec\u751f\u6210\u4e00\u4e2a\u5b9e\u73b0 <code>EventHandler</code> \u7684\u8bbf\u95ee\u5668\u6ce8\u518c\u5230 bus \u4e0a\u3002   \u5982\u679c\u4f60\u9700\u8981\u4f7f\u7528 GraalVM Native-Image\uff0c\u90a3\u4e48 <code>AsmListenerResolver</code> \u5c06\u4f1a\u65e0\u6cd5\u5de5\u4f5c\u3002\u5c4a\u65f6\u8bf7\u4f7f\u7528 <code>io.ib67.kiwi.event.util.ReflectionListenerResolver</code> \u626b\u63cf\u7136\u540e\u81ea\u884c\u6ce8\u518c\uff0c\u5177\u6709\u8f83\u597d\u7684\u517c\u5bb9\u6027\uff08\u4f7f\u7528 tracing-agent \u540e\uff09</p> <p>\u8fd9\u4e24\u79cd ListenerResolver \u5747\u4f1a\u4f7f\u7528 <code>MethodHandles.Lookup</code>. \u56e0\u6b64\u5982\u679c\u4f60\u7684\u4ee3\u7801\u4e0d\u6ee1\u8db3\u6761\u4ef6 (2) \u53ef\u80fd\u4f1a\u51fa\u73b0\u8bbf\u95ee\u6743\u9650\u9519\u8bef\uff0c\u5c4a\u65f6\u81ea\u884c\u4f20\u9012 <code>MethodHandles.lookup()</code> \u5373\u53ef</p>"},{"location":"kiwi/events/#_5","title":"\u5173\u4e8e\u6027\u80fd","text":"<p>Note</p> <p>\u5728\u5bf9 kiwi-event \u8fdb\u884c\u57fa\u51c6\u6d4b\u8bd5\u4ee5\u53ca\u89e3\u8bfb\u524d\uff0c\u8bf7\u786e\u4fdd\u4f60\u5df2\u7ecf\u5145\u5206\u5730\u9605\u8bfb\u4e86 kiwi:event \u4e2d jmh sourceSet \u7684\u4ee3\u7801 \u5e76\u4e14\u660e\u786e\u6d4b\u8bd5\u76ee\u6807\uff0c\u5176\u57fa\u51c6\u6d4b\u8bd5\u4ee3\u7801\u7684\u542b\u4e49\uff0c\u4ee5\u53ca\u7406\u89e3\u6d4b\u8bd5\u540e\u5f97\u5230\u7684\u6570\u5b57\u7684\u542b\u4e49\u3002\u4e0d\u8981\u5047\u8bbe\u4ed6\u4eec\u60f3\u544a\u8bc9 \u4f60\u60f3\u8ba9\u4ed6\u4eec\u544a\u8bc9 \u7684\u4e1c\u897f\u3002 \u5fc5\u8981\u65f6\uff0c\u8bf7\u54a8\u8be2\u4e13\u5bb6\u6216\u8005 Maintainer \u7684\u610f\u89c1\u3002</p> <p>\u6839\u636e\u57fa\u51c6\u6d4b\u8bd5\u7684\u7ed3\u8bba\u6765\u770b\uff0c\u76ee\u524d HierarchyEventBus \u7684\u4f20\u9012\u901f\u5ea6\u5e76\u4e0d\u53d7\u7c7b\u578b\u5c42\u7ea7\u7684\u539f\u56e0\u800c\u4ea7\u751f\u660e\u663e\u7684\u6027\u80fd\u964d\u7ea7\u3002\u4f20\u9012\u901f\u5ea6\u4e3b\u8981\u4e0e\u6574\u6761\u94fe\u8def\u4e0a\u7684\u76d1\u542c\u5668\u4e2a\u6570\u6709\u5173\u3002</p> <p>EventBus \u4f20\u9012\u4e8b\u4ef6\u7684\u4ee3\u7801\u94fe\u8def\u4e0a\u6bd4\u8f83\u7b80\u5355\uff0c\u5e76\u4e14\u4e0d\u4f1a\u5f15\u5165\u989d\u5916\u7684\u5185\u5b58\u5206\u914d\uff0c\u4f20\u9012\u4e00\u6b21\u4e8b\u4ef6\u53ea\u9700\u8981\u5fae\u79d2\uff08\u901a\u5e38\u66f4\u4f4e\uff09\u91cf\u7ea7\u7684\u65f6\u95f4\uff0c\u53ef\u4ee5\u9002\u5e94\u7edd\u5927\u591a\u6570\u7684\u60c5\u666f\u3002</p>"}]}